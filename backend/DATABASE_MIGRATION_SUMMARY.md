# æ•¸æ“šåº«é·ç§»å®Œæˆç¸½çµ

## ğŸ‰ é·ç§»ç‹€æ…‹ï¼šæˆåŠŸå®Œæˆ

PostgreSQL æ•¸æ“šåº«å·²æˆåŠŸè¨­ç½®ä¸¦å®Œæˆè¡¨çµæ§‹é·ç§»ã€‚

## ğŸ“Š å‰µå»ºçš„è¡¨

### 1. users (ç”¨æˆ¶è¡¨)
- **ç”¨é€”**: å­˜å„²ç”¨æˆ¶åŸºæœ¬ä¿¡æ¯ã€èªè­‰ä¿¡æ¯å’Œåå¥½è¨­ç½®
- **ä¸»è¦å­—æ®µ**:
  - `id`: ä¸»éµ
  - `username`: ç”¨æˆ¶å (å”¯ä¸€)
  - `email`: é›»å­éƒµä»¶ (å”¯ä¸€)
  - `password`: åŠ å¯†å¯†ç¢¼
  - `displayName`: é¡¯ç¤ºåç¨±
  - `role`: ç”¨æˆ¶è§’è‰² (user/premium/admin)
  - `preferences`: ç”¨æˆ¶åå¥½è¨­ç½® (JSON)
  - `membership`: æœƒå“¡ä¿¡æ¯ (JSON)
  - `statistics`: ç”¨æˆ¶çµ±è¨ˆæ•¸æ“š (JSON)

### 2. cards (å¡ç‰‡è¡¨)
- **ç”¨é€”**: å­˜å„²å¡ç‰‡åŸºæœ¬ä¿¡æ¯å’Œå¸‚å ´æ•¸æ“š
- **ä¸»è¦å­—æ®µ**:
  - `id`: ä¸»éµ
  - `name`: å¡ç‰‡åç¨±
  - `setName`: ç³»åˆ—åç¨±
  - `cardNumber`: å¡ç‰‡ç·¨è™Ÿ
  - `rarity`: ç¨€æœ‰åº¦ (common/uncommon/rare/mythic/special)
  - `cardType`: å¡ç‰‡é¡å‹
  - `currentPrice`: ç•¶å‰åƒ¹æ ¼
  - `marketPrice`: å¸‚å ´åƒ¹æ ¼
  - `priceHistory`: åƒ¹æ ¼æ­·å² (JSON)
  - `marketData`: å¸‚å ´æ•¸æ“š (JSON)

### 3. collections (æ”¶è—è¡¨)
- **ç”¨é€”**: ç®¡ç†ç”¨æˆ¶çš„å¡ç‰‡æ”¶è—
- **ä¸»è¦å­—æ®µ**:
  - `id`: ä¸»éµ
  - `name`: æ”¶è—åç¨±
  - `description`: æ”¶è—æè¿°
  - `isPublic`: æ˜¯å¦å…¬é–‹
  - `userId`: ç”¨æˆ¶å¤–éµ
  - `tags`: æ¨™ç±¤ (JSON)
  - `statistics`: æ”¶è—çµ±è¨ˆ (JSON)

### 4. investments (æŠ•è³‡è¡¨)
- **ç”¨é€”**: è¨˜éŒ„ç”¨æˆ¶çš„æŠ•è³‡æ­·å²
- **ä¸»è¦å­—æ®µ**:
  - `id`: ä¸»éµ
  - `purchasePrice`: è³¼è²·åƒ¹æ ¼
  - `purchaseDate`: è³¼è²·æ—¥æœŸ
  - `quantity`: æ•¸é‡
  - `condition`: å¡ç‰‡ç‹€æ³
  - `userId`: ç”¨æˆ¶å¤–éµ
  - `cardId`: å¡ç‰‡å¤–éµ
  - `currentValue`: ç•¶å‰åƒ¹å€¼
  - `profitLoss`: ç›ˆè™§é‡‘é¡
  - `profitLossPercentage`: ç›ˆè™§ç™¾åˆ†æ¯”

### 5. collection_cards (æ”¶è—å¡ç‰‡é—œè¯è¡¨)
- **ç”¨é€”**: ç®¡ç†æ”¶è—ä¸­çš„å¡ç‰‡
- **ä¸»è¦å­—æ®µ**:
  - `id`: ä¸»éµ
  - `collectionId`: æ”¶è—å¤–éµ
  - `cardId`: å¡ç‰‡å¤–éµ
  - `quantity`: æ•¸é‡
  - `condition`: å¡ç‰‡ç‹€æ³
  - `isFoil`: æ˜¯å¦ç‚ºé–ƒå¡
  - `isSigned`: æ˜¯å¦ç°½å
  - `isGraded`: æ˜¯å¦è©•ç´š
  - `grade`: è©•ç´šåˆ†æ•¸
  - `estimatedValue`: ä¼°è¨ˆåƒ¹å€¼

### 6. price_alerts (åƒ¹æ ¼æé†’è¡¨)
- **ç”¨é€”**: ç®¡ç†åƒ¹æ ¼æé†’è¨­ç½®
- **ä¸»è¦å­—æ®µ**:
  - `id`: ä¸»éµ
  - `alertType`: æé†’é¡å‹ (above/below/change)
  - `targetPrice`: ç›®æ¨™åƒ¹æ ¼
  - `percentageChange`: ç™¾åˆ†æ¯”è®ŠåŒ–
  - `userId`: ç”¨æˆ¶å¤–éµ
  - `cardId`: å¡ç‰‡å¤–éµ
  - `isActive`: æ˜¯å¦å•Ÿç”¨
  - `notificationChannels`: é€šçŸ¥æ¸ é“ (JSON)

## ğŸ”— å¤–éµé—œè¯

å·²å»ºç«‹ä»¥ä¸‹å¤–éµç´„æŸï¼š

1. `collections.userId` â†’ `users.id`
2. `investments.userId` â†’ `users.id`
3. `investments.cardId` â†’ `cards.id`
4. `price_alerts.userId` â†’ `users.id`
5. `price_alerts.cardId` â†’ `cards.id`
6. `collection_cards.collectionId` â†’ `collections.id`
7. `collection_cards.cardId` â†’ `cards.id`

## ğŸ“‹ æ•¸æ“šåº«ç´¢å¼•

å·²å‰µå»ºä»¥ä¸‹ç´¢å¼•ä»¥å„ªåŒ–æŸ¥è©¢æ€§èƒ½ï¼š

### users è¡¨
- `username` (å”¯ä¸€ç´¢å¼•)
- `email` (å”¯ä¸€ç´¢å¼•)

### cards è¡¨
- `setName + cardNumber` (è¤‡åˆå”¯ä¸€ç´¢å¼•)
- `name` (æ™®é€šç´¢å¼•)
- `rarity` (æ™®é€šç´¢å¼•)
- `currentPrice` (æ™®é€šç´¢å¼•)

### collections è¡¨
- `userId` (æ™®é€šç´¢å¼•)
- `name` (æ™®é€šç´¢å¼•)
- `isPublic` (æ™®é€šç´¢å¼•)

### investments è¡¨
- `userId` (æ™®é€šç´¢å¼•)
- `cardId` (æ™®é€šç´¢å¼•)
- `purchaseDate` (æ™®é€šç´¢å¼•)
- `condition` (æ™®é€šç´¢å¼•)

### collection_cards è¡¨
- `collectionId + cardId` (è¤‡åˆå”¯ä¸€ç´¢å¼•)
- `collectionId` (æ™®é€šç´¢å¼•)
- `cardId` (æ™®é€šç´¢å¼•)

### price_alerts è¡¨
- `userId` (æ™®é€šç´¢å¼•)
- `cardId` (æ™®é€šç´¢å¼•)
- `isActive` (æ™®é€šç´¢å¼•)
- `alertType` (æ™®é€šç´¢å¼•)

## ğŸ› ï¸ å¯ç”¨çš„å‘½ä»¤

```bash
# åˆå§‹åŒ–æ•¸æ“šåº«
npm run db:init

# é‹è¡Œé·ç§»
npm run db:migrate

# é©—è­‰è¡¨çµæ§‹
npm run db:verify

# é‡ç½®æ•¸æ“šåº« (åˆå§‹åŒ– + é·ç§»)
npm run db:reset

# å¡«å……æ¸¬è©¦æ•¸æ“š (å¾…å¯¦ç¾)
npm run db:seed
```

## âœ… é©—è­‰çµæœ

- âœ… æ‰€æœ‰ 6 å€‹è¡¨éƒ½å·²æˆåŠŸå‰µå»º
- âœ… æ‰€æœ‰å¤–éµç´„æŸéƒ½å·²æ­£ç¢ºè¨­ç½®
- âœ… æ‰€æœ‰ç´¢å¼•éƒ½å·²å‰µå»º
- âœ… æ•¸æ“šé¡å‹å®šç¾©æ­£ç¢º
- âœ… é»˜èªå€¼è¨­ç½®æ­£ç¢º
- âœ… ç´„æŸæ¢ä»¶è¨­ç½®æ­£ç¢º

## ğŸš€ ä¸‹ä¸€æ­¥

1. **å•Ÿå‹•æœå‹™å™¨**: `npm run dev`
2. **æ¸¬è©¦ API ç«¯é»**: è¨ªå• `http://localhost:3000/health`
3. **å‰µå»ºæ¸¬è©¦æ•¸æ“š**: å¯¦ç¾ `db:seed` è…³æœ¬
4. **API é–‹ç™¼**: åŸºæ–¼é€™äº›è¡¨çµæ§‹é–‹ç™¼ REST API

## ğŸ“ æ³¨æ„äº‹é …

1. **æ•¸æ“šåº«é€£æ¥**: ç¢ºä¿ PostgreSQL æœå‹™æ­£åœ¨é‹è¡Œ
2. **ç’°å¢ƒè®Šé‡**: ç¢ºä¿ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` æ­£ç¢ºè¨­ç½®
3. **æ¬Šé™**: ç¢ºä¿æ•¸æ“šåº«ç”¨æˆ¶æœ‰é©ç•¶çš„æ¬Šé™
4. **å‚™ä»½**: åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­å®šæœŸå‚™ä»½æ•¸æ“šåº«

## ğŸ”§ æ•…éšœæ’é™¤

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š

1. PostgreSQL æœå‹™æ˜¯å¦é‹è¡Œ
2. æ•¸æ“šåº«é€£æ¥å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¢º
3. ç”¨æˆ¶æ¬Šé™æ˜¯å¦è¶³å¤ 
4. ç«¯å£ 5432 æ˜¯å¦å¯ç”¨

æ•¸æ“šåº«é·ç§»å·²å®Œæˆï¼Œå¯ä»¥é–‹å§‹é–‹ç™¼æ‡‰ç”¨åŠŸèƒ½ï¼
