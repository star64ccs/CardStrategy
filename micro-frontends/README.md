# CardStrategy 微前端架構

## 📋 概述
CardStrategy 微前端架構是一個基於 Webpack Module Federation 的現代化前端架構，支持多個獨立模組的開發、部署和集成。

### 核心組件
1. **Shell 應用** - 主應用容器，負責路由和模組協調
2. **卡片管理模組** - 卡片 CRUD 操作和搜索功能
3. **市場分析模組** - 價格分析和市場趨勢
4. **AI 生態系統模組** - AI 掃描和預測功能
5. **用戶管理模組** - 用戶認證和權限管理
6. **投資組合模組** - 投資組合管理和分析
7. **社交功能模組** - 社交互動和分享功能

## 🚀 快速開始

### 環境要求
- Node.js >= 18.0.0
- npm >= 8.0.0
- 現代瀏覽器支持

### 安裝和設置
```bash
# 克隆項目
git clone <repository-url>
cd CardStrategy/micro-frontends

# 安裝依賴
npm run install:all

# 啟動開發服務器
npm run dev
```

### 開發命令
```bash
# 啟動所有模組的開發服務器
npm run dev
# 構建所有模組
npm run build
# 運行測試
npm run test:all
# 代碼檢查
npm run lint
npm run lint:fix
```

## 🧪 測試系統

### 測試類型
1. **單元測試** - 使用 Jest 和 React Testing Library
2. **集成測試** - 模組間通信和狀態管理測試
3. **端到端測試** - 使用 Playwright 進行完整用戶流程測試
4. **性能測試** - 全面的性能基準和優化測試
5. **安全測試** - 基本和高級安全漏洞檢測
6. **可訪問性測試** - WCAG 2.1 AA 標準的完整可訪問性檢測

### 性能測試詳解

#### 性能基準測試 (`performance-benchmark.test.ts`)
- **頁面加載性能**: DOM 內容加載、首次內容繪製、最大內容繪製等
- **模組加載性能**: 各微前端模組的動態加載時間
- **API 響應性能**: 後端 API 的響應時間和錯誤率
- **內存使用監控**: JavaScript 堆內存使用和增長情況
- **渲染性能**: 幀率、丟幀檢測、動畫流暢度

#### 負載測試 (`load-testing.test.ts`)
- **輕度負載測試**: 10個並發用戶，30秒持續時間
- **中度負載測試**: 50個並發用戶，60秒持續時間
- **重度負載測試**: 100個並發用戶，90秒持續時間
- **壓力測試**: 200個並發用戶，120秒持續時間
- **API 端點負載測試**: 多個 API 端點的並發請求測試
- **數據庫查詢性能測試**: 各種查詢類型的性能評估

#### 性能優化測試 (`performance-optimization.test.ts`)
- **代碼分割和模組化**: JavaScript 包大小、chunk 數量、動態加載
- **圖片優化和懶加載**: 圖片大小、格式、懶加載功能
- **緩存策略**: Service Worker、緩存命中率、離線功能
- **壓縮和傳輸**: Gzip 壓縮、HTTP/2 支持、資源優化
- **內存優化**: 內存洩漏檢測、垃圾回收效率
- **渲染性能**: 幀率監控、動畫流暢度、響應式設計

### 安全測試詳解

#### 基本安全測試 (`security-testing.test.ts`)
- **XSS 漏洞檢測**: 跨站腳本攻擊防護測試
- **SQL 注入檢測**: 數據庫注入攻擊防護測試
- **CSRF 漏洞檢測**: 跨站請求偽造防護測試
- **認證漏洞檢測**: 用戶認證機制安全性測試
- **授權漏洞檢測**: 權限控制機制測試
- **輸入驗證測試**: 用戶輸入數據驗證測試
- **會話管理測試**: 用戶會話安全性測試
- **HTTPS/SSL 測試**: 傳輸層安全性測試

#### 高級安全測試 (`advanced-security-testing.test.ts`)
- **滲透測試**: 目錄遍歷、文件上傳、命令注入等
- **加密測試**: 數據加密、密鑰管理、證書驗證
- **安全標頭測試**: CSP、HSTS、X-Frame-Options 等
- **API 安全測試**: 端點保護、速率限制、認證驗證
- **JWT 安全測試**: Token 算法、篡改檢測、過期處理
- **業務邏輯漏洞**: 價格操縱、數量限制繞過等
- **信息洩露測試**: 敏感信息暴露檢測
- **XML 外部實體注入**: XXE 漏洞檢測

### 性能監控工具

#### PerformanceMonitor 類
```typescript
import { PerformanceMonitor } from './tests/performance/performance-monitor';

const monitor = new PerformanceMonitor(page, {
  enableRealTimeMonitoring: true,
  collectInterval: 5000,
  maxDataPoints: 100,
  enableAlerts: true
});

await monitor.startMonitoring();
// ... 執行測試
const report = monitor.getPerformanceReport();
```

#### 監控指標
- **頁面加載指標**: DOM 內容加載、首次內容繪製、最大內容繪製
- **資源加載指標**: 總資源數量、平均加載時間、最慢資源
- **內存使用指標**: JavaScript 堆內存、內存增長趨勢
- **API 性能指標**: 響應時間、錯誤率、最慢端點
- **渲染性能指標**: 幀率、丟幀數量、動畫流暢度
- **用戶交互指標**: 交互次數、平均響應時間

### 運行性能測試
```bash
# 運行所有性能測試
npm run test:performance

# 運行特定性能測試
npm run test:performance:benchmark
npm run test:performance:load
npm run test:performance:optimization

# 生成性能報告
npm run test:performance:report

# 使用 Lighthouse 進行性能分析
npm run test:performance:lighthouse

# 分析打包大小
npm run test:performance:analyze

### 運行安全測試
```bash
# 運行所有安全測試
npm run test:security

# 運行基本安全測試
npm run test:security:basic

# 運行高級安全測試
npm run test:security:advanced

# 生成安全測試報告
npm run test:security:report

# 快速安全測試
npm run security:quick

# 完整安全測試
npm run security:full

# 僅生成安全報告
npm run security:report
```
```

### 性能基準
- **頁面加載**: DOM 內容加載 < 1.5秒，最大內容繪製 < 2秒
- **API 響應**: 平均響應時間 < 1秒，錯誤率 < 5%
- **內存使用**: 內存增長 < 100MB，總使用量 < 512MB
- **渲染性能**: 幀率 > 30 FPS，丟幀 < 10幀
- **代碼分割**: 總包大小 < 2MB，平均 chunk 大小 < 500KB

### 安全基準
- **安全評分**: 目標 > 90分 (A級)
- **漏洞數量**: 嚴重漏洞 = 0，高風險漏洞 ≤ 2
- **測試覆蓋率**: 安全測試覆蓋率 > 95%
- **認證機制**: 多因素認證、強密碼策略
- **數據保護**: 敏感數據加密、傳輸加密
- **訪問控制**: 基於角色的權限控制

## 📈 性能優化

### 已實現優化
- **代碼分割**: 按模組動態加載
- **圖片優化**: WebP 格式 + 懶加載
- **緩存策略**: 瀏覽器緩存 + CDN
- **壓縮**: Gzip + Brotli 壓縮
- **預加載**: 關鍵資源預加載
- **內存管理**: 垃圾回收優化
- **渲染優化**: 虛擬化列表 + 防抖節流

### 優化策略
1. **代碼分割**: 使用 Webpack Module Federation 實現按需加載
2. **圖片優化**: 使用 WebP 格式、懶加載、響應式圖片
3. **緩存優化**: Service Worker、HTTP 緩存、CDN 分發
4. **壓縮優化**: Gzip/Brotli 壓縮、代碼混淆、Tree Shaking
5. **內存優化**: 避免內存洩漏、及時垃圾回收、對象池
6. **渲染優化**: 虛擬化、防抖節流、CSS 優化

## 🔒 安全考慮

### 已實現安全措施
- **CSP**: 內容安全策略
- **HTTPS**: 強制 HTTPS 連接
- **XSS 防護**: 輸入驗證和轉義
- **CSRF 防護**: Token 驗證
- **權限控制**: 基於角色的訪問控制

## 📊 性能報告

### 報告格式
- **JSON 報告**: 詳細的性能數據和指標
- **HTML 報告**: 可視化的性能報告界面
- **Markdown 報告**: 便於版本控制的文本報告

### 報告內容
- **性能評分**: 0-100 的綜合性能分數
- **測試摘要**: 通過率、關鍵問題、警告數量
- **性能指標**: 頁面加載、API 性能、內存使用、渲染性能
- **優化建議**: 基於測試結果的具體改進建議

### 生成報告
```bash
# 生成完整性能報告
npm run test:performance:report

# 查看報告文件
open test-results/performance/performance-report.html
```

## 🔒 安全報告

### 報告格式
- **JSON 報告**: 詳細的安全測試數據和違規記錄
- **HTML 報告**: 可視化的安全報告界面
- **Markdown 報告**: 便於版本控制的文本報告

### 報告內容
- **安全評分**: 0-100 的綜合安全分數和等級 (A-F)
- **違規統計**: 按嚴重程度和類型分類的違規數量
- **漏洞詳情**: 具體的安全漏洞描述和技術細節
- **安全建議**: 基於測試結果的修復建議和最佳實踐

### 安全等級標準
- **A級 (90-100分)**: 優秀 - 安全性極高
- **B級 (80-89分)**: 良好 - 安全性高
- **C級 (70-79分)**: 一般 - 安全性中等
- **D級 (60-69分)**: 較差 - 存在安全風險
- **F級 (0-59分)**: 危險 - 存在嚴重安全漏洞

### 生成安全報告
```bash
# 生成完整安全報告
npm run test:security:report

# 查看報告文件
open test-results/security-report.html
```

## ♿ 可訪問性測試

### 可訪問性測試詳解

#### 基本可訪問性測試 (`accessibility-testing.test.ts`)
- **頁面標題測試**: 檢查頁面是否有描述性標題
- **圖片替代文本測試**: 驗證所有圖片是否有適當的 alt 屬性
- **表單標籤測試**: 確保所有表單控件都有正確的標籤
- **鍵盤導航測試**: 驗證所有功能都可以通過鍵盤訪問
- **顏色對比度測試**: 檢查文本與背景的對比度是否符合標準
- **ARIA 屬性測試**: 驗證 ARIA 標籤和角色的正確使用
- **標題結構測試**: 檢查頁面標題層次結構的合理性
- **語言屬性測試**: 驗證頁面語言屬性的設置

#### 高級可訪問性測試 (`advanced-accessibility-testing.test.ts`)
- **屏幕閱讀器導航測試**: 模擬屏幕閱讀器的使用體驗
- **表單可訪問性測試**: 驗證表單的完整可訪問性
- **動態內容可訪問性測試**: 檢查動態加載內容的可訪問性
- **鍵盤陷阱測試**: 確保沒有鍵盤陷阱
- **錯誤處理可訪問性測試**: 驗證錯誤信息的可訪問性
- **狀態更新可訪問性測試**: 檢查狀態變化的可訪問性通知
- **焦點管理測試**: 驗證焦點的正確管理和指示
- **語義化標記測試**: 檢查 HTML 語義化標記的使用

### 可訪問性基準
- **WCAG 2.1 AA 合規性**: 目標 > 95% 合規率
- **可訪問性評分**: 目標 > 90分 (A級)
- **違規數量**: 嚴重違規 = 0，高風險違規 ≤ 3
- **測試覆蓋率**: 可訪問性測試覆蓋率 > 90%
- **鍵盤可訪問性**: 100% 功能可通過鍵盤訪問
- **屏幕閱讀器支持**: 完整的屏幕閱讀器支持

### 運行可訪問性測試
```bash
# 運行所有可訪問性測試
npm run test:accessibility

# 運行基本可訪問性測試
npm run test:accessibility:basic

# 運行高級可訪問性測試
npm run test:accessibility:advanced

# 生成可訪問性測試報告
npm run test:accessibility:report

# 快速可訪問性測試
npm run accessibility:quick

# 完整可訪問性測試
npm run accessibility:full

# 僅生成可訪問性報告
npm run accessibility:report
```

### 可訪問性等級標準
- **A級 (90-100分)**: 優秀 - 可訪問性極高
- **B級 (80-89分)**: 良好 - 可訪問性高
- **C級 (70-79分)**: 一般 - 可訪問性中等
- **D級 (60-69分)**: 較差 - 存在可訪問性問題
- **F級 (0-59分)**: 危險 - 存在嚴重可訪問性問題

### 生成可訪問性報告
```bash
# 生成完整可訪問性報告
npm run test:accessibility:report

# 查看報告文件
open test-results/accessibility-report.html
```

## 🛠️ 開發指南

### 添加新模組
1. 在 `micro-frontends/` 目錄下創建新模組目錄
2. 配置 `webpack.config.js` 和 `package.json`
3. 在 Shell 應用中註冊新模組
4. 添加相應的測試用例

### 性能測試最佳實踐
1. **基準測試**: 在每次重要更改後運行基準測試
2. **負載測試**: 在發布前進行負載測試
3. **監控**: 在生產環境中持續監控性能指標
4. **優化**: 根據測試結果進行針對性優化

### 安全測試最佳實踐
1. **定期測試**: 在每次發布前進行安全測試
2. **自動化**: 將安全測試集成到 CI/CD 流程
3. **漏洞修復**: 優先修復嚴重和高風險漏洞
4. **安全培訓**: 定期進行安全意識培訓
5. **安全審計**: 定期進行第三方安全審計

### 可訪問性測試最佳實踐
1. **設計階段**: 在設計階段就考慮可訪問性需求
2. **開發階段**: 使用語義化 HTML 和 ARIA 屬性
3. **測試階段**: 定期進行可訪問性測試
4. **用戶測試**: 邀請殘障用戶進行實際使用測試
5. **持續改進**: 根據測試結果持續改進可訪問性
6. **培訓**: 定期進行可訪問性開發培訓

### 調試技巧
- 使用 Chrome DevTools 的 Performance 面板
- 監控 Network 面板的資源加載
- 使用 Memory 面板檢測內存洩漏
- 查看 Console 中的性能警告

## 📝 貢獻指南

### 代碼規範
- 使用 TypeScript 進行類型安全開發
- 遵循 ESLint 規則
- 編寫單元測試和集成測試
- 保持代碼覆蓋率 > 80%

### 性能要求
- 新功能必須通過性能測試
- 不得引入性能回歸
- 遵循性能基準要求
- 提供性能測試報告

### 安全要求
- 新功能必須通過安全測試
- 不得引入安全漏洞
- 遵循安全基準要求
- 提供安全測試報告
- 實施安全最佳實踐

### 可訪問性要求
- 新功能必須通過可訪問性測試
- 不得引入可訪問性問題
- 遵循 WCAG 2.1 AA 標準
- 提供可訪問性測試報告
- 實施可訪問性最佳實踐
- 確保鍵盤和屏幕閱讀器支持

## 🚀 部署

### 生產環境
```bash
# 構建生產版本
npm run build

# 運行所有測試
npm run test:all

# 部署到生產環境
npm run deploy
```

### 性能監控
- 使用 New Relic 或 Sentry 進行生產環境監控
- 設置性能警報和自動化報告
- 定期進行性能審計和優化

## 📞 支持

### 文檔
- [開發指南](./docs/developer-guide/)
- [用戶手冊](./docs/user-guide/)
- [API 文檔](./docs/api/)

### 問題反饋
- 創建 GitHub Issue
- 提供詳細的錯誤信息和重現步驟
- 附上性能測試報告（如果適用）

### 性能問題
- 運行 `npm run test:performance` 收集數據
- 生成性能報告並分析結果
- 根據建議進行優化
- 重新測試驗證改進效果

### 安全問題
- 運行 `npm run test:security` 收集數據
- 生成安全報告並分析結果
- 根據建議修復漏洞
- 重新測試驗證修復效果

### 可訪問性問題
- 運行 `npm run test:accessibility` 收集數據
- 生成可訪問性報告並分析結果
- 根據建議修復可訪問性問題
- 重新測試驗證修復效果
- 考慮邀請殘障用戶進行實際測試

---

**注意**: 本項目使用微前端架構，請確保了解相關概念和最佳實踐。如有問題，請參考文檔或聯繫開發團隊。
